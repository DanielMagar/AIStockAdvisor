/* empty css              */(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function r(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function l(e){if(e.ep)return;e.ep=!0;const t=r(e);fetch(e.href,t)}})();function A(n){const o=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),l=String(n.getDate()).padStart(2,"0");return`${o}-${r}-${l}`}function D(n){const o=new Date;return o.setDate(o.getDate()-n),A(o)}const I={startDate:D(3),endDate:D(1)},c=[];let g=[],m=null;const L=document.querySelector(".generate-report-btn");function y(n,o="info",r="",l=5e3){const e=document.getElementById("toast-container"),t=document.createElement("div");t.className=`toast ${o}`;const s={error:"❌",warning:"⚠️",success:"✅",info:"ℹ️"},u={error:r||"Error",warning:r||"Warning",success:r||"Success",info:r||"Info"};t.innerHTML=`
        <span class="toast-icon">${s[o]}</span>
        <div class="toast-content">
            <div class="toast-title">${u[o]}</div>
            <div class="toast-message">${n}</div>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">×</button>
    `,e.appendChild(t),setTimeout(()=>{t.style.animation="slideOut 0.3s ease",setTimeout(()=>t.remove(),300)},l)}L.addEventListener("click",P);window.addEventListener("DOMContentLoaded",()=>{const o=new URLSearchParams(window.location.search).get("ticker");o&&o.trim().length>0&&(document.getElementById("ticker-input").value=o,document.getElementById("ticker-input-form").dispatchEvent(new Event("submit")),y(`Added ${o} from Browse Stocks`,"success","Ticker Added",3e3))});document.getElementById("ticker-input-form").addEventListener("submit",n=>{n.preventDefault();const o=document.getElementById("ticker-input"),r=o.value.trim();if(r.length>0){const l=r.split(",").map(s=>s.trim().toUpperCase()).filter(s=>s.length>0);if(l.length===0){const s=document.querySelector(".ticker-label");s.style.color="red",s.textContent="Please enter valid stock ticker(s)";return}const e=l.filter(s=>!/^[A-Z]{1,5}$/.test(s));if(e.length>0){const s=document.querySelector(".ticker-label");s.style.color="red",s.textContent=`Invalid ticker format: ${e.join(", ")}. Use only letters (1-5 chars)`;return}l.forEach(s=>{c.length<3&&!c.includes(s)&&c.push(s)}),c.length>0&&(L.disabled=!1),o.value="",$();const t=document.querySelector(".ticker-label");t.style.color="#94a3b8",t.textContent="Selected Tickers:",c.length>=3&&(t.style.color="#f59e0b",t.textContent="Maximum 3 tickers reached")}else{const l=document.querySelector(".ticker-label");l.style.color="red",l.textContent="Please enter a valid stock ticker (e.g., AAPL, TSLA, V, KO)"}});function $(){const n=document.querySelector(".ticker-choice-display"),o=document.getElementById("clear-tickers-btn");if(n.innerHTML="",c.length===0){n.textContent="Your tickers will appear here…",o.style.display="none";return}o.style.display="block",c.forEach((r,l)=>{const e=document.createElement("span");e.textContent=r,n.appendChild(e),l<c.length-1&&n.appendChild(document.createTextNode(", "))})}document.getElementById("clear-tickers-btn").addEventListener("click",()=>{c.length=0,$(),L.disabled=!0;const n=document.querySelector(".ticker-label");n.style.color="#94a3b8",n.textContent="Selected Tickers:",y("All tickers cleared","info","Cleared",2e3)});const x=document.querySelector(".loading-panel");document.getElementById("api-message");async function P(){document.querySelector(".action-panel").style.display="none",x.style.display="flex";const n=[];try{const r=(await Promise.all(c.map(async e=>{const t=`https://polygon-api-worker.magar-t-daniel.workers.dev/?ticker=${e}&start=${I.startDate}&end=${I.endDate}`;try{const s=await fetch(t);if(s.status!==200)return n.push(e),null;const a=await s.json();if(!a.results||a.results.length===0)return n.push(e),null;const h=a.results.map(d=>({date:new Date(d.t).toISOString().split("T")[0],close:d.c,open:d.o})),w=a.results.map((d,S)=>{const E=new Date(d.t).toISOString().split("T")[0];return`Day ${S+1} (${E}): opened at $${d.o}, closed at $${d.c}`});return{ticker:e,text:`${e}:
${w.join(`
`)}
`,chartData:h}}catch{return n.push(e),null}}))).filter(e=>e!==null);if(r.length===0){x.style.display="none",document.querySelector(".action-panel").style.display="block",n.forEach(e=>{const t=c.indexOf(e);t>-1&&c.splice(t,1)}),$(),y(`No data found for: ${n.join(", ")}

Possible reasons:
• Ticker doesn't exist or is misspelled
• Not a US stock
• No recent trading data available

Please verify the ticker symbols and try again.`,"error","Invalid Tickers",8e3);return}n.length>0&&(n.forEach(e=>{const t=c.indexOf(e);t>-1&&c.splice(t,1)}),y(`Could not fetch data for: ${n.join(", ")}

These tickers were removed. Continuing with: ${r.map(e=>e.ticker).join(", ")}

Tip: Double-check ticker spelling (e.g., GOOGL not GOGLE)`,"warning","Some Tickers Failed",7e3)),g=r,c.length=0,r.forEach(e=>c.push(e.ticker));const l=r.map(e=>e.text).join(`
`);console.log(`Formatted stock data sent to AI:
`,l),q(l)}catch(o){x.style.display="none",document.querySelector(".action-panel").style.display="block",y("Error fetching stock data. Please try again.","error","Fetch Error"),console.error("Fetch stock data error:",o)}}async function q(n){const o=[{role:"system",content:`
You are a colourful, dramatic stock market guru.
Given price data for one or more stocks over the past few days,
write a fun, punchy report (max 150 words total).

For each stock:
- Mention the opening and closing prices.
- Describe the trend (up, down, volatile, flat).
- End with a clear recommendation: Buy, Hold, or Sell.

Style:
- Energetic
- Playful
- Slightly over-the-top
- No bullet points
- No markdown
- Plain text only
`},{role:"user",content:n}];try{const l=await fetch("https://openai-api-worker.magar-t-daniel.workers.dev/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!l.ok)throw new Error(`API returned ${l.status}: ${l.statusText}`);const e=await l.text();console.log("AI worker raw response:",e);const t=e.replace(/###\s*/g,"").replace(/\*\*/g,"").replace(/-\s+/g,"• ");B(t)}catch(r){console.error("AI API Error:",r.message),x.style.display="none",document.querySelector(".action-panel").style.display="block",y(`Our AI service is temporarily unavailable. Please try again in a few moments.

If the issue persists, please check your API configuration.`,"error","Service Unavailable",8e3)}}function B(n){document.querySelector(".action-panel").style.display="none",document.querySelector(".output-panel").style.display="block",x.style.display="none";const r=document.querySelector(".output-panel").querySelector(".report-card");r.innerHTML="",n.split(/\n\n+/).forEach(s=>{const u=document.createElement("p");let a=s.trim();a=a.replace(/\b(Buy|BUY)\b/g,'<span class="highlight-buy">$1</span>'),a=a.replace(/\b(Sell|SELL)\b/g,'<span class="highlight-sell">$1</span>'),a=a.replace(/\b(Hold|HOLD)\b/g,'<span class="highlight-hold">$1</span>'),u.innerHTML=a,r.appendChild(u)});const e=document.getElementById("verdict-badges");e.innerHTML="";const t=n.toLowerCase();g.forEach(s=>{const u=s.ticker,a=document.createElement("span");a.className="verdict-badge";const h=t.indexOf(u.toLowerCase());if(h===-1){a.textContent=`${u}: HOLD`,a.classList.add("hold"),e.appendChild(a);return}const w=g.map(i=>t.indexOf(i.ticker.toLowerCase(),h+1)).filter(i=>i>h).sort((i,v)=>i-v)[0]||t.length,d=t.substring(h,Math.min(w,h+500)),S=[/\bgo ahead and buy\b/,/\bbuy now\b/,/\btime to buy\b/,/\brecommend.*buy\b/,/\bverdict.*buy\b/,/\badvice.*buy\b/,/\bshould buy\b/,/\bmust buy\b/],E=[/\bgo ahead and sell\b/,/\bsell now\b/,/\btime to sell\b/,/\brecommend.*sell\b/,/\bverdict.*sell\b/,/\badvice.*sell\b/,/\bshould sell\b/,/\bmust sell\b/],O=[/\bgo ahead and hold\b/,/\bhold now\b/,/\btime to hold\b/,/\brecommend.*hold\b/,/\bverdict.*hold\b/,/\badvice.*hold\b/,/\bshould hold\b/,/\bmust hold\b/,/\bhold for now\b/,/\bhold tight\b/];let f="HOLD",k="hold";if(S.some(i=>i.test(d)))f="BUY",k="buy";else if(E.some(i=>i.test(d)))f="SELL",k="sell";else if(O.some(i=>i.test(d)))f="HOLD",k="hold";else{const i=[...d.matchAll(/\bbuy\b/g)],v=[...d.matchAll(/\bsell\b/g)],C=[...d.matchAll(/\bhold\b/g)];let p={type:"hold",index:-1};if(i.length>0){const b=i[i.length-1];b.index>p.index&&(p={type:"buy",index:b.index})}if(v.length>0){const b=v[v.length-1];b.index>p.index&&(p={type:"sell",index:b.index})}if(C.length>0){const b=C[C.length-1];b.index>p.index&&(p={type:"hold",index:b.index})}f=p.type.toUpperCase(),k=p.type}a.textContent=`${u}: ${f}`,a.classList.add(k),e.appendChild(a)}),r.classList.remove("buy","hold","sell"),t.includes("buy")?r.classList.add("buy"):t.includes("sell")?r.classList.add("sell"):r.classList.add("hold"),M()}function M(){m&&m.destroy();const n=document.getElementById("stockChart").getContext("2d"),o=["#10b981","#3b82f6","#f59e0b","#ef4444","#8b5cf6"],r=g.map((e,t)=>({label:e.ticker,data:e.chartData.map(s=>s.close),borderColor:o[t%o.length],backgroundColor:o[t%o.length]+"20",borderWidth:3,tension:.4,fill:!0})),l=g[0]?.chartData.map(e=>e.date)||[];m=new Chart(n,{type:"line",data:{labels:l,datasets:r},options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{labels:{color:"#e2e8f0",font:{size:14,weight:600}}},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.95)",titleColor:"#10b981",bodyColor:"#e2e8f0",borderColor:"#10b981",borderWidth:1,padding:12,displayColors:!0}},scales:{y:{ticks:{color:"#94a3b8",callback:function(e){return"$"+e.toFixed(2)}},grid:{color:"rgba(148, 163, 184, 0.1)"}},x:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"}}}}})}const T=document.querySelector(".new-report-btn");T&&T.addEventListener("click",()=>{c.length=0,g=[],m&&(m.destroy(),m=null),document.querySelector(".ticker-choice-display").textContent="Your tickers will appear here…",document.getElementById("ticker-input").value="",document.querySelector(".generate-report-btn").disabled=!0,document.querySelector(".output-panel").style.display="none",document.querySelector(".action-panel").style.display="block"});
